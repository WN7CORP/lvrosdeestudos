
<html><head><base href="https://docs.google.com/spreadsheets/d/1-RVXr9sFxJOGmiHmTwqtLkFyykeBBBYPguaED58wVHQ/edit?usp=sharing"><meta name="viewport" content="width=device-width, initial-scale=1.0"><style>
/* Existing CSS styles... */
@keyframes bookFallIn {
  0% {
    opacity: 0;
    transform: translateY(-20px) rotate(-2deg);
  }
  70% {
    transform: translateY(5px) rotate(1deg);
  }
  100% {
    opacity: 1;
    transform: translateY(0) rotate(0);
  }
}

@keyframes bookRiseUp {
  0% {
    opacity: 0;
    transform: translateY(20px);
  }
  100% {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

@keyframes countUp {
  0% {
    transform: scale(1);
    opacity: 0.5;
  }
  50% {
    transform: scale(1.2);
    opacity: 0.8;
  }
  100% {
    transform: scale(1);
    opacity: 1;
  }
}

.book-card {
  animation: none;
  opacity: 0;
  transform: translateY(20px);
  transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

.book-card.visible {
  opacity: 1;
  transform: translateY(0);
}

.header {
  animation: fadeInUp 0.8s ease-out;
}

.search-container {
  animation: fadeInUp 0.8s ease-out 0.2s backwards;
}

.stats-container {
  animation: fadeInUp 0.8s ease-out 0.4s backwards;
}

.recommendation {
  animation: fadeInUp 0.8s ease-out 0.6s backwards;
}

.recent-reads {
  animation: fadeInUp 0.8s ease-out 0.8s backwards;
}

/* Existing CSS styles... */
*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#181818;color:#fff}.container{max-width:1200px;margin:0 auto;padding:20px;width:100%;position: relative;}.header{background:#2d2d2d;padding:30px;box-shadow:0 4px 15px rgba(0,0,0,.3);margin-bottom:30px;border-radius:15px}.header h1{text-align:center;margin-bottom:20px;color:#fff;transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);transform-origin: center;}.stats-container{display:flex;justify-content:space-between;align-items:center;margin-top:20px;padding:15px;background:rgba(0,0,0,.2);border-radius:10px}.book-count,.area-book-count{color:#fff;font-size:14px}.category-count{color:#fff;font-size:14px}.recommendation{display: flex;align-items: center;justify-content: space-between;gap: 20px;background:#2d2d2d;padding:20px;border-radius:15px;margin:20px 0;box-shadow:0 4px 15px rgba(0,0,0,.3)}.recommendation-content{flex: 1;}.recommendation-animation{width: 100px;height: 100px;flex-shrink: 0;}.recommendation h3{color:#fff;margin-bottom:15px;text-transform:uppercase;}.recommendation p{color:#ddd;line-height:1.6}.home-btn{position:static;display:none;padding:10px 20px;background:linear-gradient(135deg,#a8030a,#c91f27);border:none;border-radius:10px;color:#fff;cursor:pointer;box-shadow:0 4px 15px rgba(0,0,0,.3);transition:all .3s;margin-top:10px;margin-bottom:20px}.home-btn:hover{transform:translateY(-3px);box-shadow:0 6px 20px rgba(0,0,0,.4);background:linear-gradient(135deg,#c91f27,#a8030a)}.recent-reads{margin:20px 0;padding:20px;background:#2d2d2d;border-radius:15px;box-shadow:0 4px 15px rgba(0,0,0,.3)}.recent-reads h2{margin-bottom:15px;color:#fff}.recent-books{display:flex;gap:20px;overflow-x:auto;padding:10px 0;scrollbar-width: thin;}.recent-book{min-width:150px;background:#333;border-radius:10px;padding:10px;transition:transform .3s;cursor:pointer}.recent-book:hover{transform:scale(1.05)}.recent-book img{width:100%;height:200px;object-fit:cover;border-radius:8px}.recent-book h4{font-size:12px;color:#888; text-align: center; padding: 5px; line-height: 1.2; margin: 0; font-weight: normal;}.search-container{display: flex;justify-content: center;margin: 20px 0;padding: 0 15px;transition: opacity 0.3s ease;}.search-container.hidden {display: none;}.search-box{position:relative;width:80%;max-width:600px;z-index:101;}.search-input{width:100%;padding:12px 20px;font-size:14px;border:2px solid #444;border-radius:30px;outline:none;transition:all .3s;background:#333;color:#fff;box-shadow:0 4px 15px rgba(0, 0, 0, 0.3);}.search-input:focus{border-color:#444;box-shadow:0 0 25px rgba(168, 3, 10, 0.3);}.search-icon{position:absolute;right:20px;top:50%;transform:translateY(-50%);color:#888}.search-preview{position:absolute;top:100%;left:0;width:100%;background:#333;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,.3);max-height:300px;overflow-y:auto;z-index:100;margin-top:5px;}.preview-item{padding:12px 20px;border-bottom:1px solid #444;cursor:pointer;transition:all .3s;font-size:14px;}.preview-item:hover{background:#444;}.preview-item:last-child{border-bottom:none;}.preview-item small{font-size:12px;opacity:0.7;}.tabs{display:grid;gap:20px;padding:20px;grid-template-columns:repeat(auto-fit,minmax(200px,1fr))}.tab{padding:12px 24px;background:#2d2d2d;border:none;border-radius:20px;cursor:pointer;transition:all .3s;color:#fff;box-shadow:0 2px 8px rgba(0,0,0,.2)}.tab:hover,.tab.active{background:linear-gradient(135deg,#a8030a,#c91f27);color:#fff;box-shadow:0 4px 12px rgba(168, 3, 10, .3)}.books-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 25px; padding: 20px; transition: opacity 0.4s ease-in-out, transform 0.4s cubic-bezier(0.4, 0, 0.2, 1); } .book-card { background: #2d2d2d; border-radius: 12px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4); display: flex; flex-direction: column; height: auto; margin: 0 auto; width: 100%; max-width: 250px; cursor: pointer; position: relative; opacity: 0; transform: translateY(20px); transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1); animation: none; } .book-card.visible { opacity: 1; transform: translateY(0); } .book-cover { width: 100%; height: auto; object-fit: contain; background: #1a1a1a; padding: 10px; display: block; margin: 0 auto; } .book-info { padding: 15px; display: flex; flex-direction: column; align-items: flex-start; gap: 8px; width: 100%; } .book-title { font-size: 14px; color: #fff; text-align: left; line-height: 1.4; margin: 0; font-weight: normal; width: 100%; } .rating { display: flex; align-items: center; gap: 5px; background: rgba(255, 255, 255, 0.05); padding: 4px 8px; border-radius: 4px; width: fit-content; } .rating span:last-child { color: #888; font-size: 12px; } .read-btn { width: 100%; padding: 10px; border: none; border-radius: 10px; color: white; cursor: pointer; transition: all 0.3s; font-weight: bold; background: linear-gradient(135deg, #a8030a, #c91f27); margin-top: auto; text-align: center; text-decoration: none; } .read-btn:hover { background: linear-gradient(135deg, #c91f27, #a8030a); box-shadow: 0 4px 12px rgba(168, 3, 10, 0.3); } .download-btn { width: 100%; padding: 10px; border: none; border-radius: 10px; color: white; cursor: pointer; transition: all 0.3s; font-weight: bold; background: linear-gradient(135deg, #C5A572, #DAA520) !important; /* Golden gradient */ margin-top: 10px; text-align: center; /* Center the text */ text-decoration: none; /* Remove text decorations */ box-shadow: 0 4px 12px rgba(218, 165, 32, 0.3); /* Golden shadow */ } .download-btn:hover { background: linear-gradient(135deg, #DAA520, #B8860B) !important; /* Darker golden gradient on hover */ box-shadow: 0 6px 15px rgba(218, 165, 32, 0.5); /* Enhanced shadow on hover */ } @media (max-width: 768px) { .books-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; padding: 15px; } .book-card { max-width: 250px; } .book-card { max-width: 250px; } .read-btn { padding: 8px; font-size: 14px; } .search-box { width: 90%; } .search-input { font-size: 14px; padding: 10px 15px; } .preview-item { padding: 10px 15px; font-size: 13px; } } @media (max-width: 480px) { .books-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 10px; padding: 10px; } .book-card { max-width: 200px; } .read-btn { padding: 8px; font-size: 13px; } } .iframe-modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.95);z-index:1000}.iframe-container{position:fixed;top:0;left:0;width:100%;height:100%;background:#2d2d2d}.close-btn{position:fixed;top:15px;right:15px;background:linear-gradient(135deg,#a8030a,#c91f27);border:none;padding:8px 15px;border-radius:8px;cursor:pointer;color:#fff;z-index:1001;transition:all .3s}.close-btn:hover{background:linear-gradient(135deg,#c91f27,#a8030a);box-shadow:0 4px 12px rgba(168, 3, 10, 0.3)}.home-content{display:none}.home-content{margin-top:20px;}.recommendation{margin-top:30px;}.area-book-count.highlight { animation: highlightText 1.5s ease-in-out; font-weight: bold; color: #c91f27; } @keyframes highlightText { 0% { transform: scale(1); color: #fff; } 50% { transform: scale(1.1); color: #c91f27; } 100% { transform: scale(1); color: #c91f27; } } .mode-tabs { display: none; } .category-card { position: relative; cursor: pointer; border-radius: 12px; overflow: hidden; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.3); background: #2d2d2d; animation: bookFallIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) backwards; } .category-card:hover { transform: scale(1.05); box-shadow: 0 8px 25px rgba(0,0,0,0.4); } .category-card img { width: 100%; height: 250px; object-fit: cover; transition: all 0.3s; } .category-card:hover img { transform: scale(1.1); } .category-card div { position: absolute; bottom: 0; left: 0; right: 0; background: rgba(0,0,0,0.7); padding: 15px; text-align: center; transition: all 0.3s; } .category-card:hover div { background: rgba(0,0,0,0.9); } @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } } @keyframes shakeError { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } } @keyframes successPulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } } .password-input { width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #444; border-radius: 10px; background: #1a1a1a; color: #fff; font-size: 16px; transition: all 0.3s ease; } .password-input.error { border-color: #ff4444; animation: shakeError 0.5s ease; } .password-input.success { border-color: #00ff00; animation: successPulse 0.5s ease; } .password-modal { background: rgba(0,0,0,0.95); backdrop-filter: blur(5px); animation: none; } .password-content { background: linear-gradient(145deg, #2d2d2d, #222); box-shadow: 0 8px 32px rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); transition: all 0.3s ease; } .password-content.error { animation: shakeError 0.5s ease; box-shadow: 0 0 20px rgba(255,0,0,0.5); border: 1px solid #ff4444; } .password-content.success { animation: successPulse 0.5s ease; box-shadow: 0 0 20px rgba(0,255,0,0.5); border: 1px solid #00ff00; } @keyframes shakeError { 0%, 100% { transform: translateX(0); } 20% { transform: translateX(-15px); background: rgba(255,0,0,0.2); } 40% { transform: translateX(15px); } 60% { transform: translateX(-10px); } 80% { transform: translateX(10px); } } .favorite-btn { position: absolute; top: 10px; right: 10px; background: none; border: none; cursor: pointer; z-index: 2; transition: all 0.3s ease; padding: 8px; border-radius: 50%; backdrop-filter: blur(5px); background: rgba(0,0,0,0.5); } .favorite-btn svg { width: 24px; height: 24px; fill: transparent; stroke: #fff; stroke-width: 2; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); } .favorite-btn.active svg { fill: #ff4444; stroke: #ff4444; transform: scale(1.1); } .favorite-btn:hover svg { transform: scale(1.1); } .book-card { position: relative; } @keyframes heartbeat { 0% { transform: scale(1); } 25% { transform: scale(1.2); } 50% { transform: scale(1); } 75% { transform: scale(1.2); } 100% { transform: scale(1); } } .favorite-btn.active svg.heartbeat { animation: heartbeat 0.8s ease-in-out; } /* Add styles for empty favorites message */ #favorites-books p { padding: 20px; font-style: italic; background: rgba(0,0,0,0.2); border-radius: 10px; margin: 10px 0; } /* Enhance favorites section styling */ #favorites-section { background: #2d2d2d; border-radius: 15px; padding: 20px; margin-bottom: 30px; box-shadow: 0 4px 15px rgba(0,0,0,.3); } #favorites-section h2 { color: #fff; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; } #favorites-section h2::before { content: '♥'; color: #ff4444; } .book-card.found { animation: foundBookPulse 1s ease-in-out 3; } @keyframes foundBookPulse { 0% { transform: scale(1); box-shadow: 0 8px 20px rgba(168, 3, 10, 0.3); } 50% { transform: scale(1.05); box-shadow: 0 8px 25px rgba(168, 3, 10, 0.5); } 100% { transform: scale(1); box-shadow: 0 8px 20px rgba(168, 3, 10, 0.3); } } /* Scrollbar styling */ *::-webkit-scrollbar { width: 8px; height: 8px; } *::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.1); border-radius: 10px; } *::-webkit-scrollbar-thumb { background: linear-gradient(135deg,#a8030a,#c91f27); border-radius: 10px; } *::-webkit-scrollbar-thumb:hover { background: linear-gradient(135deg,#c91f27,#a8030a); } @keyframes bookFallIn { 0% { opacity: 0; transform: translateY(-20px) rotate(-2deg); } 70% { transform: translateY(5px) rotate(1deg); } 100% { opacity: 1; transform: translateY(0) rotate(0); } } @keyframes bookRiseUp { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } } @keyframes zoomInBook { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.8; } 100% { transform: scale(30); opacity: 0; } } @keyframes bookRiseUp { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } } .filter-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
  margin: 0 20px 10px;
  opacity: 0.8;
  transition: opacity 0.3s;
}

.filter-buttons:hover {
  opacity: 1;
}

.filter-btn {
  padding: 8px 15px;
  background: #2d2d2d;
  border: 1px solid rgba(255,255,255,0.1);
  border-radius: 20px;
  color: #888;
  cursor: pointer;
  transition: all 0.3s;
}

.filter-btn.active {
  background: #444;
  color: #fff;
  border-color: rgba(255,255,255,0.2);
}

.filter-btn:hover {
  background: #444;
  color: #fff;
}

.tab-btn {
  transition: background 0.3s;
}

.tab-btn.active {
  background: #666 !important;
}

.tab-content {
  transition: opacity 0.3s;
  max-height: 200px;
  overflow-y: auto;
  padding: 10px;
  background: rgba(0,0,0,0.2);
  border-radius: 8px;
}

.navigation-buttons {
  display: none;
}

.navigation-buttons.visible {
  display: flex;
  gap: 10px;
  margin: 0 15px 20px;
  justify-content: center;
  flex-wrap: wrap;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}

@keyframes fadeInScale {
  from {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}

@keyframes shimmer {
  0% { background-position: -200% center; }
  100% { background-position: 200% center; }
}

/* Adjust book title styles */
.book-title {
  font-size: 14px; /* Increase font size by 2 levels */
  color: #fff; /* Make the text white for better readability */
}

/* Adjust font size for smaller devices */
@media (max-width: 768px) {
  .book-title {
    font-size: 16px; /* Further increase size for better readability on mobile */
  }
}

@media (max-width: 480px) {
  .book-title {
    font-size: 18px; /* Further increase size for extra small devices */
  }
}
</style><script src="https://unpkg.com/@dotlottie/player-component@2.7.12/dist/dotlottie-player.mjs" type="module"></script><script>
// Remove the menu logic and directly open the book
function checkPassword(link, title, cover) {
    // Reset monthly counts if needed
    checkAndResetMonthlyCounts();
    
    // Directly open the book
    const zoomOverlay = document.createElement('div');
    zoomOverlay.style.cssText = ` 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(0,0,0,0.9); 
        z-index: 2000; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
    `;
    
    const zoomImage = document.createElement('img');
    zoomImage.src = cover;
    zoomImage.style.cssText = ` 
        width: 200px; 
        height: auto; 
        animation: zoomInBook 1s cubic-bezier(0.4, 0, 0.2, 1) forwards; 
    `;
    
    zoomOverlay.appendChild(zoomImage);
    document.body.appendChild(zoomOverlay);
    
    // After zoom animation, show the book
    setTimeout(() => {
        document.body.removeChild(zoomOverlay);
        const modal = document.getElementById('iframe-modal');
        const iframe = document.getElementById('book-iframe');
        document.querySelector('.home-btn').style.display = 'none';
        iframe.src = link;
        modal.style.display = 'block';
        startReadingTimer();
    }, 1000);

    // Update reading statistics and recent reads
    userStats.reads++; // Increment daily reads
    localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
    addToRecentReads({ title, link, cover });
}
</script></head><body><div class="container">
    <div style="text-align: left; font-size: 12px; color: #888; margin-bottom: 10px;" id="last-update"></div>
    <button class="home-btn" onclick="showHome()"><i class="fas fa-home"></i> Início</button>
    <div class="header">
      <div style="display: flex; justify-content: center; margin-bottom: 20px;">
        <dotlottie-player src="https://lottie.host/bb80cbb5-86bc-4831-8dca-141d55b9966f/VGXCHhV6AJ.lottie" background="transparent" speed="1" style="width: 200px; height: 200px;" loop="" autoplay=""></dotlottie-player>
      </div>
      <h1>Biblioteca Jurídica</h1>
      <div style="text-align: center; font-size: 12px; color: #888; margin-bottom: 15px;">Quem lê, lidera. Quem não lê... fica esperando o milagre acontecer. 📚💭</div>
      <div class="search-container hidden">
        <div class="search-box">
          <input type="text" class="search-input" placeholder="Pesquisar livros...">
          <i class="search-icon fas fa-search"></i>
        </div>
      </div>
      <div class="stats-container">
        <div class="book-count" id="book-count"></div>
        <div class="category-count" id="category-count"></div>
      </div>
    </div>
    <div class="navigation-buttons" style="
      display: none;
      gap: 10px;
      margin: 0 15px 20px;
      justify-content: center;
      flex-wrap: wrap;
    ">
      <button onclick="showSection('recent-reads')" class="nav-btn" style="
        flex: 1;
        min-width: 150px;
        max-width: 200px;
        padding: 15px;
        background: #2d2d2d;
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 14px;
      ">
        <i class="fas fa-history"></i>
        Últimas Leituras
        <span class="count-badge" style="
          background: rgba(168, 3, 10, 0.2);
          padding: 2px 8px;
          border-radius: 10px;
          font-size: 12px;
          color: #c91f27;
        " id="recent-count">0</span>
      </button>
      
      <button onclick="showSection('favorites')" class="nav-btn" style="
        flex: 1;
        min-width: 150px;
        max-width: 200px;
        padding: 15px;
        background: #2d2d2d;
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        color: #fff;
        cursor: pointer;
        transition: all 0.3s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        font-size: 14px;
      ">
        <i class="fas fa-heart"></i>
        Favoritos
        <span class="count-badge" style="
          background: rgba(168, 3, 10, 0.2);
          padding: 2px 8px;
          border-radius: 10px;
          font-size: 12px;
          color: #c91f27;
        " id="favorites-count">0</span>
      </button>
    </div>
    <div class="tabs" id="tabs"></div>
    <div id="home-content" class="home-content">
      <div class="recommendation">
        <div class="recommendation-content">
          <h3>REFLITA</h3>
          <p id="daily-recommendation">Carregando recomendação...</p>
        </div>
        <iframe class="recommendation-animation" src="https://lottie.host/embed/727109e7-6fe0-44f8-8e93-d168b2f9f0c2/fi5yyQLYCL.lottie" frameborder="0"></iframe>
      </div>
      <div class="recent-reads" id="recent-reads-section">
        <h2>Últimas Leituras</h2>
        <div class="recent-books" id="recent-books"></div>
      </div>
      <div class="recent-reads" id="favorites-section" style="margin-bottom: 30px;">
        <h2>Meus Favoritos</h2>
        <div class="recent-books" id="favorites-books"></div>
      </div>
    </div>
    <div class="filter-buttons">
      <button class="filter-btn active" data-sort="alpha">Ordem Alfabética</button>
      <button class="filter-btn" data-sort="rating">Melhor Avaliados</button>
    </div>
    <div class="books-grid" id="books-grid"></div>
  </div><div class="iframe-modal" id="iframe-modal"><div class="iframe-container"><button class="close-btn" onclick="closeModal()">Fechar</button><iframe id="book-iframe" width="100%" height="100%" frameborder="0"></iframe></div></div><script src="https://kit.fontawesome.com/a076d05399.js"></script><script>
const USER_STORAGE_KEY = 'user_reading_stats';
let userStats = JSON.parse(localStorage.getItem(USER_STORAGE_KEY)) || { reads: 0, downloads: 0, lastReset: new Date().getTime() };
const recentReads = JSON.parse(localStorage.getItem('recentReads')) || [];
const favorites = JSON.parse(localStorage.getItem('favorites')) || []; // Add this line

function checkAndResetMonthlyCounts() {
  const now = new Date().getTime();
  const thirtyDays = 30 * 24 * 60 * 60 * 1000;
  if (now - userStats.lastReset > thirtyDays) {
    userStats = { reads: 0, downloads: 0, lastReset: now };
    localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
  }
}

function addToRecentReads(book) {
  const bookData = {
    title: book.title,
    link: book.link, 
    cover: book.cover,
    timestamp: new Date().getTime()
  };

  // Remove duplicate if exists
  const existingIndex = recentReads.findIndex(r => r.link === book.link);
  if (existingIndex > -1) {
    recentReads.splice(existingIndex, 1);
  }

  // Add to beginning of array
  recentReads.unshift(bookData);

  // Keep only last 20 reads
  if (recentReads.length > 20) {
    recentReads.pop();
  }

  localStorage.setItem('recentReads', JSON.stringify(recentReads));
  updateRecentReads();
}

const API_KEY='AIzaSyCbD-rljbYoW1suOkyq8-ZA__BTtT7UCfU';
const SPREADSHEET_ID='1-RVXr9sFxJOGmiHmTwqtLkFyykeBBBYPguaED58wVHQ';
let downloadBooks = {};
const DOWNLOAD_SPREADSHEET_ID = '1NJSOtgvZE-ckuXX0JQEBaBctKSa5T02I_nZ8iQc8IGY';
let currentMode = 'read';
const books={};
let currentTab=''; 
let sheets=[];
let phrases=[];

let readingStartTime = 0;
let totalReadingTime = parseInt(localStorage.getItem('totalReadingTime')) || 0;
let isReading = false;

function startReadingTimer() {
  readingStartTime = Date.now();
  isReading = true;
}

function stopReadingTimer() {
  if (isReading) {
    const readingDuration = Date.now() - readingStartTime;
    totalReadingTime += readingDuration;
    localStorage.setItem('totalReadingTime', totalReadingTime);
    isReading = false;
  }
}

function handleScrollAnimation() {
  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry, index) => {
      if (entry.isIntersecting) {
        setTimeout(() => {
          entry.target.style.animationDelay = `${index * 0.1}s`;
          entry.target.style.animation = 'bookFallIn 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards';
          entry.target.classList.add('visible');
        }, index * 50);
      }
    });
  }, {
    threshold: 0.1,
    rootMargin: '20px'
  });

  const elementsToAnimate = document.querySelectorAll('.book-card');
  elementsToAnimate.forEach(el => observer.observe(el));
}

async function loadAccessPhrases() {
  const PHRASES_SPREADSHEET_ID = '1qIJtMbbCd75XpX3P7TBmZX7MqMxvTerXZkVnGCDWlcA';
  try {
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${PHRASES_SPREADSHEET_ID}/values/nova!A:A?key=${API_KEY}`);
    const data = await response.json();
    return data.values?.slice(1).map(row => row[0]) || [];
  } catch (error) {
    console.error('Error loading access phrases:', error);
    return [];
  }
}

function formatDate(date) {
  return date.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit', year: 'numeric' });
}

function updateLastUpdateDate() {
  const lastUpdateElement = document.getElementById('last-update');
  const now = new Date();
  let lastUpdate = localStorage.getItem('lastUpdateDate');
  if (!lastUpdate || (now - new Date(lastUpdate)) > (3 * 24 * 60 * 60 * 1000)) {
    lastUpdate = now.toISOString();
    localStorage.setItem('lastUpdateDate', lastUpdate);
  }
  lastUpdateElement.textContent = `Última atualização: ${formatDate(new Date(lastUpdate))}`
}

async function loadPhrases(){
  try{
    const response=await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/frases?key=${API_KEY}`);
    const data=await response.json();
    if(data.values){
      phrases=data.values.slice(1).map(row=>row[0])
    }
  }catch(error){
    console.error('Error loading phrases:',error)
  }
}

async function loadSheetData(){
  try{
    // Show header content immediately with animations
    const header = document.querySelector('.header');
    const searchContainer = document.querySelector('.search-container');
    const statsContainer = document.querySelector('.stats-container');
    
    // Add loading state animations
    header.style.animation = 'fadeInUp 0.8s ease-out';
    searchContainer.style.animation = 'fadeInUp 0.8s ease-out 0.2s backwards';
    statsContainer.style.animation = 'fadeInUp 0.8s ease-out 0.4s backwards';
    
    // Show temporary loading stats
    document.getElementById('book-count').textContent = 'Total de Livros: Carregando...';
    document.getElementById('category-count').textContent = 'Categorias: Carregando...';
    
    // Load sheet data in background
    const readResponse = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}?key=${API_KEY}`);
    const readData = await readResponse.json();
    sheets = readData.sheets;
    
    // Load tabs with animation
    const tabsContainer = document.getElementById('tabs');
    tabsContainer.style.display = 'grid';
    tabsContainer.style.gridTemplateColumns = 'repeat(auto-fit, minmax(200px, 1fr))';
    tabsContainer.style.gap = '20px';
    tabsContainer.style.padding = '20px';
    tabsContainer.innerHTML = '';
    
    // Load each sheet data sequentially
    for(const sheet of sheets) {
      if(sheet.properties.title.toLowerCase() !== 'frases') {
        const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${sheet.properties.title}?key=${API_KEY}`);
        const data = await response.json();
        
        if(data.values && data.values[1]) {
          const categoryCover = data.values[1][4];
          if(categoryCover) {
            const coverCard = document.createElement('div');
            coverCard.className = 'category-card';
            coverCard.style.animation = 'bookFallIn 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) backwards';
            coverCard.innerHTML = `
              <img src="${data.values[1][4]}" alt="${sheet.properties.title}" style="width: 100%; height: 250px; object-fit: cover;">
              <div style="
                position: absolute; 
                bottom: 0; 
                left: 0; 
                right: 0; 
                background: rgba(0,0,0,0.7); 
                padding: 10px; 
                text-align: center;
              ">
                <h3 style="color: #fff; font-size: 16px;">${sheet.properties.title}</h3>
              </div>
            `;
            coverCard.onmouseover = () => { 
              coverCard.style.transform = 'scale(1.05)';
            };
            coverCard.onmouseout = () => { 
              coverCard.style.transform = 'scale(1)';
            };
            coverCard.onclick = () => changeTab(sheet.properties.title);
            tabsContainer.appendChild(coverCard);
          }
        }
        
        books[sheet.properties.title] = data.values.slice(1).map(row => ({ 
          link: row[1], // Column B - links
          title: row[2], // Column C - book titles
          cover: row[3], // Column D - book covers
          categoryCover: row[4], // Column E - area covers  
          synopsis: row[5] || 'Informação não disponível.', // Column F - synopsis
          rating: row[6] || '0.0', // Column G - rating
          analysis: row[7] || 'Análise não disponível.' // Column H - analysis
        }));
      } 
    }
    
    // Update stats with animation after loading
    const totalBooks = Object.values(books).reduce((total, categoryBooks) => total + categoryBooks.length, 0);
    const bookCountElement = document.getElementById('book-count');
    const categoryCountElement = document.getElementById('category-count');
    
    bookCountElement.style.animation = 'countUp 0.5s ease-out';
    categoryCountElement.style.animation = 'countUp 0.5s ease-out';
    
    bookCountElement.textContent = `Total de Livros: ${totalBooks}`;
    categoryCountElement.textContent = `Categorias: ${Object.keys(books).length}`;
    
    await loadPhrases();
    showHome();
    updateBookCount();
    
  } catch(error) {
    console.error('Error loading spreadsheet:', error);
  }
}

function getDailyRecommendation(){
  if(phrases.length>0){
    const randomIndex=Math.floor(Math.random()*phrases.length);
    document.getElementById('daily-recommendation').textContent=phrases[randomIndex]
  }else{
    const recommendations=['Dedique pelo menos 30 minutos à leitura hoje para melhorar seu conhecimento jurídico.','A leitura diária é fundamental para se manter atualizado com as mudanças na legislação.','Experimente ler sobre uma área do direito diferente hoje para expandir seus horizontes.'];
    const randomIndex=Math.floor(Math.random()*recommendations.length);
    document.getElementById('daily-recommendation').textContent=recommendations[randomIndex]
  }
}

function showHome(){
  document.getElementById('home-content').style.display='block';
  document.getElementById('books-grid').style.display='none';
  document.getElementById('recent-reads-section').style.display='block';
  document.getElementById('favorites-section').style.display='block';
  document.getElementById('tabs').style.display='grid';
  document.querySelector('.home-btn').style.display='none';
  
  // Hide filter buttons on home page
  document.querySelector('.filter-buttons').style.display = 'none';

  // Show navigation buttons
  const navButtons = document.querySelector('.navigation-buttons');
  if (navButtons) {
    navButtons.classList.add('visible');
  }
  
  // Show header and search container
  const header = document.querySelector('.header');
  header.style.display = 'block';
  const searchContainer = document.querySelector('.search-container');
  searchContainer.classList.remove('hidden');
  
  getDailyRecommendation();
  updateFavorites();
}

function changeTab(tabName){
  currentTab=tabName;
  document.getElementById('home-content').style.display='none';
  document.getElementById('books-grid').style.display='grid';
  document.getElementById('recent-reads-section').style.display='none';
  document.getElementById('favorites-section').style.display='none';
  document.getElementById('tabs').style.display='none';
  document.querySelector('.home-btn').style.display='inline-block';
  
  // Show filter buttons when viewing categories
  document.querySelector('.filter-buttons').style.display = 'flex';
  
  // Hide navigation buttons
  const navButtons = document.querySelector('.navigation-buttons');
  if (navButtons) {
    navButtons.classList.remove('visible');
  }
  
  // Hide header and search container
  const header = document.querySelector('.header');
  header.style.display = 'none';
  const searchContainer = document.querySelector('.search-container');
  searchContainer.classList.add('hidden');

  document.querySelectorAll('.tab').forEach(tab=>{tab.classList.toggle('active',tab.textContent===tabName)});
  
  const bookList = currentMode === 'read' ? books[tabName] : downloadBooks[tabName];
  displayBooks(bookList);
}

async function loadDownloadContent(sheetName) {
  try {
    const response = await fetch(`https://sheets.googleapis.com/v4/spreadsheets/${DOWNLOAD_SPREADSHEET_ID}/values/${sheetName}?key=${API_KEY}`);
    const data = await response.json();
    downloadBooks[sheetName] = data.values.slice(1).map(row => ({ 
      title: row[0], 
      link: row[1], 
      cover: row[2] 
    }));
  } catch (error) {
    console.error('Error loading download content:', error);
  }
}

function updateBookCount(){
  const totalBooks=Object.values(books).reduce((total,categoryBooks)=>total+categoryBooks.length,0);
  document.getElementById('book-count').textContent=`Total de Livros: ${totalBooks}`
}

function checkPassword(link, title, cover) {
  // Reset monthly counts if needed
  checkAndResetMonthlyCounts();
  
  // Directly open the book
  const zoomOverlay = document.createElement('div');
  zoomOverlay.style.cssText = ` 
      position: fixed; 
      top: 0; 
      left: 0; 
      width: 100%; 
      height: 100%; 
      background: rgba(0,0,0,0.9); 
      z-index: 2000; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
  `;
  
  const zoomImage = document.createElement('img');
  zoomImage.src = cover;
  zoomImage.style.cssText = ` 
      width: 200px; 
      height: auto; 
      animation: zoomInBook 1s cubic-bezier(0.4, 0, 0.2, 1) forwards; 
  `;
  
  zoomOverlay.appendChild(zoomImage);
  document.body.appendChild(zoomOverlay);
  
  // After zoom animation, show the book
  setTimeout(() => {
      document.body.removeChild(zoomOverlay);
      const modal = document.getElementById('iframe-modal');
      const iframe = document.getElementById('book-iframe');
      document.querySelector('.home-btn').style.display = 'none';
      iframe.src = link;
      modal.style.display = 'block';
      startReadingTimer();
  }, 1000);

  // Update reading statistics and recent reads
  userStats.reads++; // Increment daily reads
  localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
  addToRecentReads({ title, link, cover });
}

function showPremiumModal(link, title, cover) {
  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.95);
    z-index: 2001;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  `;

  // Create audio element for background music
  const bgMusic = new Audio('https://www.dropbox.com/scl/fi/oxp8jcx74p4grtwosf6hy/MOTIVA-O.mp3?rlkey=gdtllzgze79wdgjqo80ztu9hg&st=8yp6fbtl&dl=1');
  bgMusic.play();

  modal.innerHTML = `
    <div style="width: 100%;
      max-width: 600px;
      text-align: center;
      padding: 20px;
      position: relative;
      margin-top: -3cm;
    ">
      <img src="https://imgur.com/kluvFNz.png" 
        style="
          width: 100%;
          max-width: 400px;
          margin-bottom: 10px;
          animation: fadeInScale 1s ease-out;
        "
      >
      <h2 style="
        color: #fff;
        margin-bottom: 20px;
        font-size: 24px;
      ">Carregando seu sucesso</h2>
      
      <div style="
        background: rgba(255,255,255,0.1);
        border-radius: 20px;
        height: 30px;
        position: relative;
        overflow: hidden;
        margin-bottom: 10px;
        margin-top: -20px;
      ">
        <div class="progress-bar" style="
          position: absolute;
          left: 0;
          top: 0;
          height: 100%;
          background: linear-gradient(135deg,#a8030a,#c91f27);
          width: 0%;
          transition: width 1s linear;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #fff;
          font-weight: bold;
        ">0%</div>
      </div>
      <div style="display: flex; gap: 20px; justify-content: center;">
        <button id="lifetime-btn" style="
          padding: 15px 30px;
          background: linear-gradient(135deg,#a8030a,#c91f27);
          border: none;
          border-radius: 10px;
          color: #fff;
          font-weight: bold;
          cursor: pointer;
          animation: pulse 1.5s infinite;
          display: flex;
          flex-direction: column;
          align-items: center;
          gap: 5px;
          position: relative;
          overflow: hidden;
        ">
          <span style="
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
          ">Ser vitalício</span>
          <span style="
            background: rgba(255,255,255,0.1);
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 20px;
            color: #fff;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
          ">
            <span style="
              font-size: 12px;
              opacity: 0.8;
            ">R$</span>
            <span style="
              color: #fff;
              text-shadow: 0 0 10px rgba(255,255,255,0.5);
            ">9,99</span>
          </span>
          <div style="
            position: absolute;
            top: -20px;
            right: -20px;
            background: #DAA520;
            padding: 4px 12px;
            transform: rotate(45deg);
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
          ">OFERTA</div>
        </button>
        
        <button id="miss-chance-btn" style="
          padding: 15px 30px;
          background: #444;
          border: none;
          border-radius: 10px;
          color: #fff;
          cursor: pointer;
        ">Perder a oportunidade</button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  bgMusic.addEventListener('loadedmetadata', () => {
    const duration = bgMusic.duration;
    let progress = 0;
    
    const updateProgress = setInterval(() => {
      progress += (100 / duration);
      if (progress >= 100) {
        clearInterval(updateProgress);
        progress = 100;
        // Redirect to Play Store after progress completes
        window.open('https://play.google.com/store/apps/details?id=br.com.app.gpu3115043.gpuf229e32b5c7986a1df9977f32f013634', '_blank');
        document.body.removeChild(modal);
      }
      const progressBar = modal.querySelector('.progress-bar');
      if (progressBar) {
        progressBar.style.width = `${progress}%`;
        progressBar.textContent = `${Math.round(progress)}%`;
      }
    }, 1000);
  });

  // Handle button clicks
  document.getElementById('lifetime-btn').onclick = () => {
    bgMusic.pause(); // Stop background music
    const acceptSound = new Audio('https://www.dropbox.com/scl/fi/dzbd4crqqoxa1sq1a1d8y/vamos-nessa.mp3?rlkey=dqoncby0lpy6hitvzoo7ybguh&st=i6lgdlqh&dl=1');
    acceptSound.play();
    clearInterval(updateProgress); // Stop progress bar

    modal.innerHTML = `
      <div style="text-align: center;">
        <dotlottie-player src="https://lottie.host/fd754273-59e9-4631-b234-ff39f5fdd724/tby9Je8wnl.lottie" background="transparent" speed="1" style="width: 300px; height: 300px" loop autoplay></dotlottie-player>
      </div>
    `;

    acceptSound.onended = () => {
      document.body.removeChild(modal);
      window.open('https://play.google.com/store/apps/details?id=br.com.app.gpu3115043.gpuf229e32b5c7986a1df9977f32f013634', '_blank');
    };
  };

  document.getElementById('miss-chance-btn').onclick = () => {
    bgMusic.pause();
    const missChanceSound = new Audio('https://www.dropbox.com/scl/fi/43nr8weh748xz3big01bm/surra.mp3?rlkey=5wjj37u3al76pv7bzfvkus5be&st=iugrl1z7&dl=1');
    missChanceSound.play();
    missChanceSound.onended = () => {
      document.body.removeChild(modal);
      if (currentTab) {
        changeTab(currentTab);
      }
    };
  };
}

function showSuccessModal() {
  const successSound = new Audio('https://www.dropbox.com/scl/fi/n2ftv4uzhj1pfeajh7vwg/vencer.mp3?rlkey=gfuygk99dbpkv8mul173ldo8g&st=mtykbx9x&dl=1');
  successSound.play();

  const modal = document.createElement('div');
  modal.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.95);
    z-index: 2002;
    display: flex;
    align-items: center;
    justify-content: center;
  `;

  modal.innerHTML = `
    <div style="text-align: center;">
      <img src="https://imgur.com/LOkBssZ.png" 
        style="
          width: 80%;
          max-width: 400px;
          margin-bottom: 20px;
          animation: zoomInScale 1s ease-out;
        "
      >
      <div style="
        background: rgba(255,255,255,0.1);
        border-radius: 20px;
        height: 30px;
        position: relative;
        overflow: hidden;
        margin-bottom: 20px;
        margin-top: -10px;
      ">
        <div class="success-progress-bar" style="
          position: absolute;
          left: 0;
          top: 0;
          height: 100%;
          background: linear-gradient(135deg,#a8030a,#c91f27);
          width: 0%;
          transition: width 1s linear;
          display: flex;
          align-items: center;
          justify-content: center;
          color: #fff;
          font-weight: bold;
        ">0%</div>
      </div>
      <div style="display: flex; gap: 20px; justify-content: center;">
        <button id="accept-success" style="
          padding: 15px 30px;
          background: linear-gradient(135deg,#a8030a,#c91f27);
          border: none;
          border-radius: 10px;
          color: #fff;
          font-weight: bold;
          cursor: pointer;
          animation: pulse 1.5s infinite;
        ">Aceito o Sucesso</button>
        
        <button id="give-up" style="
          padding: 15px 30px;
          background: #444;
          border: none;
          border-radius: 10px;
          color: #fff;
          cursor: pointer;
        ">Desisto de crescer</button>
      </div>
    </div>
  `;

  document.body.appendChild(modal);

  // Progress bar animation
  let progress = 0;
  const progressBar = modal.querySelector('.success-progress-bar');
  const progressInterval = setInterval(() => {
    progress += 1;
    if (progress > 100) {
      clearInterval(progressInterval);
      progress = 100;
    }
    progressBar.style.width = `${progress}%`;
    progressBar.textContent = `${Math.round(progress)}%`;
  }, 50);

  document.getElementById('accept-success').onclick = () => {
    const acceptSound = new Audio('https://www.dropbox.com/scl/fi/dzbd4crqqoxa1sq1a1d8y/vamos-nessa.mp3?rlkey=dqoncby0lpy6hitvzoo7ybguh&st=i6lgdlqh&dl=1');
    acceptSound.play();
    successSound.pause(); // Stop success sound
    clearInterval(progressInterval); // Stop progress bar
    
    modal.innerHTML = `
      <div style="text-align: center;">
        <dotlottie-player src="https://lottie.host/fd754273-59e9-4631-b234-ff39f5fdd724/tby9Je8wnl.lottie" background="transparent" speed="1" style="width: 300px; height: 300px" loop autoplay></dotlottie-player>
      </div>
    `;

    acceptSound.onended = () => {
      document.body.removeChild(modal);
      window.open('https://play.google.com/store/apps/details?id=br.com.app.gpu3115043.gpuf229e32b5c7986a1df9977f32f013634', '_blank');
    };
  };

  document.getElementById('give-up').onclick = () => {
    const giveUpSound = new Audio('https://www.dropbox.com/scl/fi/43nr8weh748xz3big01bm/surra.mp3?rlkey=5wjj37u3al76pv7bzfvkus5be&st=iugrl1z7&dl=1');
    successSound.pause(); // Stop success sound
    clearInterval(progressInterval); // Stop progress bar
    giveUpSound.play();
    giveUpSound.onended = () => {
      document.body.removeChild(modal);
      if (currentTab) {
        changeTab(currentTab);
      }
    };
  };
}

function handleDownload(link, title, cover) {
  checkAndResetMonthlyCounts();
  const remaining = 5 - userStats.downloads;
  if (userStats.downloads >= 5) {
    showPasswordModal(link, title, cover);
  } else {
    userStats.downloads++;
    localStorage.setItem(USER_STORAGE_KEY, JSON.stringify(userStats));
    window.location.href = link;
  }
}

function showPasswordModal(link, title, cover) {
  const errorSound = new Audio('https://www.dropbox.com/scl/fi/1rl7yh8i9s4nz7n830j70/senah-incorreta.mp3?rlkey=gb0xs9ytimxzywnubxjc8afat&st=mhjf48cg&dl=1');

  const modal = document.createElement('div');
  modal.className = 'password-modal';
  modal.style.cssText = ` 
    position: fixed; 
    top: 0; 
    left: 0; 
    width: 100%; 
    height: 100%; 
    display: flex; 
    align-items: center; 
    justify-content: center; 
    z-index: 2000; 
    background: rgba(0,0,0,0.95);
    backdrop-filter: blur(5px);
  `;

  const content = document.createElement('div');
  content.className = 'password-content';
  content.style.cssText = ` 
    padding: 40px; 
    border-radius: 20px; 
    width: 90%; 
    max-width: 400px; 
    text-align: center; 
    background: #2d2d2d;
    transition: all 0.3s ease;
  `;

  content.innerHTML = `
    <div style="position: relative;"> 
      <iframe src="https://lottie.host/embed/727109e7-6fe0-44f8-8e93-d168b2f9f0c2/fi5yyQLYCL.lottie" style="width: 120px; height: 120px; margin: -20px auto 20px;" frameborder="0"></iframe>
      <h3 style="color: #fff; font-size: 24px; margin-bottom: 20px;">Acesso Exclusivo</h3> 
      <p style="color: #ddd; margin-bottom: 25px; font-size: 16px;">Digite sua senha de assinante:</p> 
      <input type="password" id="password-input" class="password-input" placeholder="Digite sua senha"> 
      <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: center;"> 
        <button id="submit-password" style=" 
          padding: 12px 25px; 
          background: linear-gradient(135deg,#a8030a,#c91f27); 
          border: none; 
          border-radius: 10px; 
          color: #fff; 
          cursor: pointer; 
          font-weight: bold; 
          transition: all 0.3s; 
        ">Acessar</button> 
        <button id="cancel-password" style=" 
          padding: 12px 25px; 
          background: #444; 
          border: none; 
          border-radius: 10px; 
          color: #fff; 
          cursor: pointer; 
          transition: all 0.3s; 
        ">Cancelar</button> 
      </div> 
    `;

  modal.appendChild(content);
  document.body.appendChild(modal);

  const passwordInput = document.getElementById('password-input');
  
  document.getElementById('submit-password').onclick = async () => {
    const password = passwordInput.value;
    if (password === '3943') {
      passwordInput.classList.add('success');
      content.classList.add('success');
      content.innerHTML = `
        <div style="position: relative; height: 300px;"> 
          <iframe src="https://lottie.host/embed/fd754273-59e9-4631-b234-ff39f5fdd724/tby9Je8wnl.lottie" style="width: 200px; height: 200px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);" frameborder="0"></iframe>
        </div> 
      `;
      await new Promise(resolve => setTimeout(resolve, 2500));
      document.body.removeChild(modal);

      // Open the book with zoom animation after successful password
      const zoomOverlay = document.createElement('div');
      zoomOverlay.style.cssText = ` 
        position: fixed; 
        top: 0; 
        left: 0; 
        width: 100%; 
        height: 100%; 
        background: rgba(0,0,0,0.9); 
        z-index: 2000; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
      `;
      
      const zoomImage = document.createElement('img');
      zoomImage.src = cover;
      zoomImage.style.cssText = ` 
        width: 200px; 
        height: auto; 
        animation: zoomInBook 1s cubic-bezier(0.4, 0, 0.2, 1) forwards; 
      `;
      
      zoomOverlay.appendChild(zoomImage);
      document.body.appendChild(zoomOverlay);
      
      setTimeout(() => {
        document.body.removeChild(zoomOverlay);
        const modal = document.getElementById('iframe-modal');
        const iframe = document.getElementById('book-iframe');
        document.querySelector('.home-btn').style.display = 'none';
        iframe.src = link;
        modal.style.display = 'block';
        startReadingTimer();
        addToRecentReads({ title, link, cover }); // Add to recent reads
      }, 1000);
    } else {
      errorSound.play();
      passwordInput.classList.add('error');
      content.classList.add('error');
      passwordInput.value = '';
      passwordInput.placeholder = 'Senha incorreta!';
      setTimeout(() => {
        passwordInput.classList.remove('error');
        content.classList.remove('error');
        passwordInput.placeholder = 'Digite sua senha';
      }, 1000);
    }
  };

  document.getElementById('cancel-password').onclick = () => {
    document.body.removeChild(modal);
  };

  passwordInput.addEventListener('input', () => {
    passwordInput.classList.remove('error', 'success');
    content.classList.remove('error', 'success');
  });
}

function toggleFavorite(event, bookLink) {
  event.stopPropagation();
  const btn = event.currentTarget;
  const svg = btn.querySelector('svg');
  const index = favorites.indexOf(bookLink);
  if (index === -1) {
    favorites.push(bookLink);
    btn.classList.add('active');
    svg.classList.add('heartbeat');
    setTimeout(() => svg.classList.remove('heartbeat'), 800);
  } else {
    favorites.splice(index, 1);
    btn.classList.remove('active');
  }
  localStorage.setItem('favorites', JSON.stringify(favorites));
  updateFavorites();
}

function updateFavorites() {
  const favoritesContainer = document.getElementById('favorites-books');
  if (!favoritesContainer) return;
  favoritesContainer.innerHTML = '';
  const allBooks = Object.values(currentMode === 'read' ? books : downloadBooks).flat().filter(book => favorites.includes(book.link)).sort((a, b) => {
    const titleA = a.title?.toLowerCase() || '';
    const titleB = b.title?.toLowerCase() || '';
    return titleA.localeCompare(titleB);
  });
  if (allBooks.length === 0) {
    favoritesContainer.innerHTML = '<p style="color: #888; text-align: center; width: 100%;">Nenhum livro favorito ainda</p>';
    return;
  }
  allBooks.forEach(book => {
    const favoriteBook = document.createElement('div');
    favoriteBook.className = 'recent-book';
    favoriteBook.innerHTML = `
      <img src="${book.cover}" alt="${book.title}">
      <h4 style="font-size: 12px; color: #888; text-align: center; padding: 5px; line-height: 1.2; margin: 0;">${book.title}</h4>
    `;
    favoriteBook.onclick = () => currentMode === 'read' ? checkPassword(book.link, book.title, book.cover) : handleDownload(book.link, book.title, book.cover);
    favoritesContainer.appendChild(favoriteBook);
  });
}

function updateRecentReads(){
  const recentContainer=document.getElementById('recent-books');
  recentContainer.innerHTML='';
  const groupedReads = recentReads.reduce((groups, book) => {
    const date = new Date(book.timestamp).toDateString();
    if (!groups[date]) {
      groups[date] = [];
    }
    groups[date].push(book);
    return groups;
  }, {});
  Object.values(groupedReads).forEach(dayBooks => {
    dayBooks.sort((a, b) => {
      const titleA = a.title?.toLowerCase() || '';
      const titleB = b.title?.toLowerCase() || '';
      return titleA.localeCompare(titleB);
    });
  });
  const sortedRecentReads = Object.values(groupedReads).flat().slice(0, 5);
  sortedRecentReads.forEach(book=>{ 
    const recentBook=document.createElement('div');
    recentBook.className='recent-book';
    recentBook.innerHTML=` 
      <img src="${book.cover}" alt="${book.title}">
      <h4 style="font-size: 12px; color: #888; text-align: center; padding: 5px; line-height: 1.2; margin: 0;">${book.title}</h4>
    `;
    recentBook.onclick=()=>checkPassword(book.link, book.title, book.cover);
    recentContainer.appendChild(recentBook)
  })
  updateStatistics();
}

function sortBooks(books, sortType) {
  if (!books) return [];
  return [...books].sort((a, b) => {
    if (sortType === 'alpha') {
      const titleA = a.title?.toLowerCase() || '';
      const titleB = b.title?.toLowerCase() || '';
      return titleA.localeCompare(titleB);
    } else if (sortType === 'rating') {
      const ratingA = parseFloat(a.rating) || 0;
      const ratingB = parseFloat(b.rating) || 0;
      return ratingB - ratingA;
    }
    return 0;
  });
}

function displayBooks(booksList) {
  const currentSort = document.querySelector('.filter-btn.active')?.dataset.sort || 'alpha';
  const sortedBooks = sortBooks(booksList, currentSort);
  const grid = document.getElementById('books-grid');
  
  grid.innerHTML = '';
  sortedBooks?.forEach((book, index) => {
    const card = document.createElement('div');
    card.className = 'book-card';
    
    card.innerHTML = `
      <button class="favorite-btn ${favorites.includes(book.link) ? 'active' : ''}" onclick="toggleFavorite(event, '${book.link}')">
        <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
        </svg>
      </button>
      <img src="${book.cover}" alt="${book.title}" class="book-cover">
      <div class="book-info">
        <h3 class="book-title">${book.title}</h3>
        <div class="rating">
          <span>${book.rating}</span>
        </div>
    `;
    card.onclick = () => { 
      showBookOptionsMenu(book, book.link, book.title, book.cover);
    };
    grid.appendChild(card);
  });

  handleScrollAnimation();
}

document.querySelector('.filter-buttons')?.addEventListener('click', (e) => {
  if (!e.target.classList.contains('filter-btn')) return;
  document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
  e.target.classList.add('active');
  const sortType = e.target.dataset.sort;
  const currentBooks = currentMode === 'read' ? (currentTab ? books[currentTab] : []) : (currentTab ? downloadBooks[currentTab] : []);
  displayBooks(currentBooks);
});

function closeBookMenu() {
  const backdrop = document.querySelector('div[style*="backdrop-filter: blur"]');
  const menu = document.querySelector('div[style*="transform: translate(-50%, -50%)"]');
  
  if (backdrop) {
    backdrop.style.opacity = '0';
    setTimeout(() => backdrop.remove(), 300);
  }
  
  if (menu) {
    menu.style.transform = 'translate(-50%, -60%)';
    menu.style.opacity = '0';
    setTimeout(() => menu.remove(), 300);
  }
}

function showBookOptionsMenu(book, link, title, cover) {
  const backdrop = document.createElement('div');
  backdrop.style.cssText = `
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.3s ease;
  `;

  const menu = document.createElement('div');
  menu.style.cssText = `
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -60%);
    background: #2d2d2d;
    padding: 20px;
    border-radius: 15px;
    z-index: 1001;
    width: 90%;
    max-width: 400px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    opacity: 0;
    transition: all 0.3s ease;
  `;

  menu.innerHTML = `
    <div style="display: flex; flex-direction: column; gap: 15px;">
      <div style="display: flex; align-items: center; gap: 15px;">
        <img src="${cover}" alt="${title}" style="width: 100px; height: auto; border-radius: 8px;">
        <div>
          <h3 style="color: #fff; margin-bottom: 8px;">${title}</h3>
          <div class="rating" style="display: flex; align-items: center; gap: 5px; background: rgba(255,255,255,0.05); padding: 4px 8px; border-radius: 4px; width: fit-content;">
            <span>${book.rating}</span>
          </div>
        </div>
      </div>
      
      <div class="book-tabs" style="display: flex; gap: 10px; margin-top: 10px;">
        <button onclick="showTab('synopsis', this)" class="tab-btn active" style="
          flex: 1;
          padding: 8px;
          background: #444;
          border: none;
          border-radius: 10px;
          color: #fff;
          cursor: pointer;
        ">Sobre</button>
        <button onclick="showTab('analysis', this)" class="tab-btn" style="
          flex: 1;
          padding: 8px;
          background: #444;
          border: none;
          border-radius: 10px;
          color: #fff;
          cursor: pointer;
        ">Análise</button>
      </div>

      <div id="synopsis-content" class="tab-content" style="color: #888; font-size: 14px; line-height: 1.5;">
        ${book.synopsis || 'Informção não disponível.'}
      </div>
      
      <div id="analysis-content" class="tab-content" style="display: none; color: #888; font-size: 14px; line-height: 1.5;">
        ${book.analysis || 'Análise não disponível.'}
      </div>

      <div style="display: flex; gap: 10px; margin-top: 10px;">
        <button onclick="openBook('${link}', '${title}', '${cover}')" class="read-btn" style="flex: 1;">Ler Agora</button>
        <button onclick="closeBookMenu()" style="
          flex: 1;
          padding: 10px;
          background: #444;
          border: none;
          border-radius: 10px;
          color: #fff;
          cursor: pointer;
          transition: all 0.3s;
        ">Fechar</button>
      </div>
    </div>
  `;

  document.body.appendChild(backdrop);
  document.body.appendChild(menu);

  requestAnimationFrame(() => {
    backdrop.style.opacity = '1';
    menu.style.opacity = '1';
    menu.style.transform = 'translate(-50%, -50%)';
  });

  backdrop.addEventListener('click', closeBookMenu);
  menu.addEventListener('click', (e) => e.stopPropagation());
}

function showTab(tabName, btn) {
  document.querySelectorAll('.tab-btn').forEach(button => {
    button.classList.remove('active');
    button.style.background = '#444';
  });
  
  document.querySelectorAll('.tab-content').forEach(content => {
    content.style.display = 'none';
  });
  
  document.getElementById(`${tabName}-content`).style.display = 'block';
  btn.classList.add('active');
  btn.style.background = '#666';
}

function openBook(link, title, cover) {
  // Close the book menu first
  closeBookMenu();
  checkPassword(link, title, cover);
}

function closeModal(){
  stopReadingTimer();
  const modal=document.getElementById('iframe-modal');
  const iframe=document.getElementById('book-iframe');
  const homeBtn=document.querySelector('.home-btn');
  iframe.src='';
  modal.style.display='none';
  homeBtn.style.display='inline-block';
}

function showSection(section) {
  if (section === 'recent-reads') {
    const modal = document.createElement('div');
    modal.style.cssText = `
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.95);
      z-index: 1000;
      display: flex;
      flex-direction: column;
      padding: 20px;
    `;

    const content = `
      <div style="background: #2d2d2d; border-radius: 15px; padding: 20px; margin-bottom: 20px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="color: #fff; margin: 0;">Últimas Leituras</h2>
          <button onclick="closeRecentReadsModal()" style="
            padding: 8px 15px;
            background: linear-gradient(135deg,#a8030a,#c91f27);
            border: none;
            border-radius: 10px;
            color: #fff;
            cursor: pointer;
          ">Voltar ao Início</button>
        </div>
        <div class="stats-container" style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
          gap: 15px;
          margin-bottom: 20px;
        ">
          <div class="stat-card" style="
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
          ">
            <h3 style="color: #c91f27; margin: 0;">Tempo Total de Leitura</h3>
            <p style="color: #fff; font-size: 20px; margin: 10px 0;">${formatReadingTime(totalReadingTime)}</p>
          </div>
          <div class="stat-card" style="
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
          ">
            <h3 style="color: #c91f27; margin: 0;">Total de Leituras</h3>
            <p style="color: #fff; font-size: 20px; margin: 10px 0;">${recentReads.length}</p>
          </div>
          <div class="stat-card" style="
            background: #1a1a1a;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
          ">
            <h3 style="color: #c91f27; margin: 0;">Média por Livro</h3>
            <p style="color: #fff; font-size: 20px; margin: 10px 0;">${calculateAverageReadingTime()}</p>
          </div>
        </div>
        <div class="books-grid" style="
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
          gap: 20px;
          padding: 20px;
        ">
          ${generateRecentReadsHTML()}
        </div>
      </div>
    `;

    modal.innerHTML = content;
    document.body.appendChild(modal);
  } else if (section === 'favorites') {
    // Keep existing favorites window logic
    const favoritesWindow = window.open('', '_blank', "width=800,height=600,left=50,top=50");
    // ... rest of favorites code
  }
}

function closeRecentReadsModal() {
  const modal = document.querySelector('[style*="position: fixed"]');
  if (modal) {
    document.body.removeChild(modal);
  }
}

function generateRecentReadsHTML() {
  return recentReads.map(book => `
    <div class="book-card visible" onclick="checkPassword('${book.link}', '${book.title}', '${book.cover}')" style="cursor: pointer;">
      <img src="${book.cover}" alt="${book.title}" class="book-cover">
      <div class="book-info">
        <h3 class="book-title">${book.title}</h3>
        <p style="color: #888; font-size: 12px;">Lido em: ${new Date(book.timestamp).toLocaleDateString()}</p>
      </div>
    </div>
  `).join('');
}

function updateStatistics() {
  const recentCount = document.getElementById('recent-count');
  const favoritesCount = document.getElementById('favorites-count');
  
  recentCount.textContent = recentReads.length;
  favoritesCount.textContent = favorites.length;
  
  // Add statistics to sections
  const recentStats = document.createElement('div');
  recentStats.className = 'section-stats';
  recentStats.style.cssText = `
    padding: 15px;
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
    margin-bottom: 15px;
    font-size: 14px;
    color: #888;
  `;
  
  const lastRead = recentReads[0];
  const lastReadDate = lastRead ? new Date(lastRead.timestamp).toLocaleDateString() : 'N/A';
  
  recentStats.innerHTML = `
    <div>Última leitura: ${lastReadDate}</div>
    <div>Total de leituras recentes: ${recentReads.length}</div>
  `;
  
  const favoritesStats = document.createElement('div');
  favoritesStats.className = 'section-stats';
  favoritesStats.style.cssText = `
    padding: 15px;
    background: rgba(0,0,0,0.2);
    border-radius: 10px;
    margin-bottom: 15px;
    font-size: 14px;
    color: #888;
  `;
  
  favoritesStats.innerHTML = `
    <div>Total de favoritos: ${favorites.length}</div>
    <div>Livros disponíveis: ${Object.values(books).flat().length}</div>
  `;
  
  const recentSection = document.getElementById('recent-reads-section');
  const favoritesSection = document.getElementById('favorites-section');
  
  // Remove existing stats if any
  const existingStats = document.querySelectorAll('.section-stats');
  existingStats.forEach(stat => stat.remove());
  
  // Add new stats
  recentSection.insertBefore(recentStats, recentSection.firstChild);
  favoritesSection.insertBefore(favoritesStats, favoritesSection.firstChild);
}

document.addEventListener('DOMContentLoaded', () => {
  loadSheetData();
  handleScrollAnimation();
  updateRecentReads();
  updateFavorites();
  getDailyRecommendation();
  updateLastUpdateDate();
  handleSearch();
});
  
function formatReadingTime(ms) {
  const seconds = Math.floor(ms / 1000);
  const minutes = Math.floor(seconds / 60);
  const hours = Math.floor(minutes / 60);
  
  if (hours > 0) {
    return `${hours}h ${minutes % 60}min`;
  } else if (minutes > 0) {
    return `${minutes}min ${seconds % 60}s`;
  } else {
    return `${seconds}s`;
  }
}

function calculateAverageReadingTime() {
  if (recentReads.length === 0) return '0min';
  const avgTime = totalReadingTime / recentReads.length;
  return formatReadingTime(avgTime);
}

function handleSearch() {
  const searchInput = document.querySelector('.search-input');
  const searchPreview = document.createElement('div');
  searchPreview.className = 'search-preview';
  
  searchInput.addEventListener('input', (e) => {
    const query = e.target.value.toLowerCase();
    searchPreview.innerHTML = '';
    
    if (query.length < 2) {
      searchPreview.remove();
      return;
    }

    const results = [];
    Object.entries(books).forEach(([category, categoryBooks]) => {
      categoryBooks.forEach(book => {
        if (book.title.toLowerCase().includes(query)) {
          results.push({...book, category});
        }
      });
    });

    if (results.length > 0) {
      results.slice(0, 5).forEach(book => {
        const item = document.createElement('div');
        item.className = 'preview-item';
        item.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px;">
            <img src="${book.cover}" style="width: 40px; height: 60px; object-fit: cover; border-radius: 4px;">
            <div>
              <div>${book.title}</div>
              <small style="color: #888;">${book.category}</small>
            </div>
          </div>
        `;
        
        item.onclick = () => {
          searchPreview.remove();
          searchInput.value = '';
          changeTab(book.category);
          
          // Wait for books to load then highlight the found book
          setTimeout(() => {
            const bookElements = document.querySelectorAll('.book-card');
            bookElements.forEach(element => {
              if (element.querySelector('.book-title').textContent === book.title) {
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
                element.classList.add('found');
                setTimeout(() => element.classList.remove('found'), 3000);
              }
            });
          }, 500);
        };
        
        searchPreview.appendChild(item);
      });
      
      if (!searchInput.parentElement.contains(searchPreview)) {
        searchInput.parentElement.appendChild(searchPreview);
      }
    } else {
      const noResults = document.createElement('div');
      noResults.className = 'preview-item';
      noResults.textContent = 'Nenhum livro encontrado';
      searchPreview.appendChild(noResults);
      
      if (!searchInput.parentElement.contains(searchPreview)) {
        searchInput.parentElement.appendChild(searchPreview);
      }
    }
  });

  // Close preview when clicking outside
  document.addEventListener('click', (e) => {
    if (!e.target.closest('.search-box')) {
      searchPreview.remove();
      searchInput.value = '';
    }
  });
}
</script></body></html>